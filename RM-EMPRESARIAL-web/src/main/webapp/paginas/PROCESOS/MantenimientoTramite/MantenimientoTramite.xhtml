<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

    <body>

        <ui:composition template="./../../../WEB-INF/template.xhtml">

            <ui:define name="title">
                <h:outputText value="Creacion | Tramite"/>
            </ui:define>

            <ui:define name="content">

                <h:form id="formTools">
                    <p:growl id="growl" life="3000"/>
                    <p:tabView id="tabsTools"
                               binding="#{controladorMantenimientoTramite.tabView}" dynamic="true" cache="false">
                        <p:tab id="tabTramite" title="Trámite">
                            <p:panel id="pnlDatos" style="border: none">
                                <p:panelGrid id="pnlCabTramite" columns="8" 
                                             columnClasses="ui-grid-col-1,ui-grid-col-2,ui-grid-col-1,ui-grid-col-2,ui-grid-col-1,ui-grid-col-2,ui-grid-col-1,ui-grid-col-2" 
                                             layout="grid" styleClass="ui-panelgrid-blank ui-fluid">

                                    <p:outputLabel for="@next" value="N°Trámite:"  style="font-weight: bold"/>
                                    <p:inputText value="#{controladorMantenimientoTramite.controladorMantenimientoTramiteBb.tramite.traNumero}"
                                                 style="font-weight: bold;color: brown"
                                                 rendered="#{!controladorMantenimientoTramite.blockTabPro}"/>
                                    <p:outputLabel value="" rendered="#{controladorMantenimientoTramite.blockTabPro}"/>
                                    <p:outputLabel value="Tipo Trámite"  style="font-weight: bold"/>
                                    <p:selectOneMenu value="#{controladorMantenimientoTramite.controladorMantenimientoTramiteBb.tramite.traTipo}" 
                                                     required="true" requiredMessage="Tipo Tràmite es un campo requerido"
                                                     disabled="#{controladorMantenimientoTramite.bloqueoTra}">
                                        <p:ajax event="valueChange" listener="#{controladorMantenimientoTramite.refresh()}" process="pnlDatos" update="pnlDatos"/>
                                        <f:selectItem  itemLabel="Seleccionar Una" itemValue=""  />
                                        <f:selectItem  itemLabel="Normal" itemValue="N"  />
                                        <f:selectItem itemLabel="Legal" itemValue="L" />
                                    </p:selectOneMenu>

                                    <p:outputLabel value="Fecha Repertorio:"  style="font-weight: bold"/>
                                    <p:calendar id="txtFechaR" value="#{controladorMantenimientoTramite.controladorMantenimientoTramiteBb.fechaRegistro}" pattern="dd-MM-yyyy"

                                                disabled="#{controladorMantenimientoTramite.bloqueoTra}"/>

                                    <p:outputLabel value="N°Repertorio" style="font-weight: bold"/>
                                    <p:inputNumber value="#{controladorMantenimientoTramite.controladorMantenimientoTramiteBb.numRepertorio}"

                                                   disabled="#{controladorMantenimientoTramite.bloqueoTra}"
                                                   decimalPlaces="0" thousandSeparator=""/>

                                    <p:outputLabel value="Ciudad:" for="cmbCiudad" style="font-weight: bold"/>
                                    <p:selectOneMenu  disabled="#{controladorMantenimientoTramite.bloqueoTra}"
                                                      id="cmbCiudad" value="#{controladorMantenimientoTramite.controladorMantenimientoTramiteBb.ciudadSeleccionada}" filter="true">
                                        <p:ajax event="itemSelect" listener="#{controladorMantenimientoTramite.cargarNotariasPorCiudad()}" update="cmbNotaria"/>
                                        <f:selectItem  itemLabel="Seleccionar una..." itemValue="" />
                                        <f:selectItems value="#{controladorMantenimientoTramite.controladorMantenimientoTramiteBb.listaCiudades}" var="ciu" itemLabel="#{ciu.ciuNombre}" itemValue="#{ciu}"/>
                                    </p:selectOneMenu>

                                    <p:outputLabel value="Notaria" for="cmbNotaria" style="font-weight: bold"/>
                                    <p:selectOneMenu disabled="#{controladorMantenimientoTramite.bloqueoTra}"  id="cmbNotaria" value="#{controladorMantenimientoTramite.controladorMantenimientoTramiteBb.tramite.traNotaria}" panelStyle="width:180px"
                                                     effect="fade" style="width:160px" filter="true" filterMatchMode="contains">
                                        <f:selectItem itemLabel="Seleccionar una..." itemValue="" />
                                        <f:selectItems value="#{controladorMantenimientoTramite.controladorMantenimientoTramiteBb.listaNotarias}" var="notaria" itemLabel="#{notaria.notNotario}" itemValue="#{notaria.notNumero}"/>
                                        <p:column style="width:10%">
                                            <h:outputText styleClass="ui-theme ui-theme-#{notaria.notNumero}" />
                                        </p:column>

                                        <p:column>
                                            <h:outputText value="#{notaria.notNotario}" />
                                        </p:column>
                                    </p:selectOneMenu>

                                    <p:outputLabel value="Juicio" for="txtJuicio" style="font-weight: bold"
                                                   rendered="#{controladorMantenimientoTramite.controladorMantenimientoTramiteBb.tramite.traTipo eq 'L'}"

                                                   />
                                    <p:inputText id="txtJuicio" readonly="#{controladorMantenimientoTramite.controladorMantenimientoTramiteBb.estado}" 
                                                 disabled="#{controladorMantenimientoTramite.bloqueoTra}"
                                                 rendered="#{controladorMantenimientoTramite.controladorMantenimientoTramiteBb.tramite.traTipo eq 'L'}"
                                                 value="#{controladorMantenimientoTramite.controladorMantenimientoTramiteBb.tramite.traJucio}"
                                                 />

                                    <p:outputLabel value="Juzgado" for="txtJuzgado" style="font-weight: bold"
                                                   rendered="#{controladorMantenimientoTramite.controladorMantenimientoTramiteBb.tramite.traTipo eq 'L'}"			   />

                                    <p:inputText id="txtJuzgado" readonly="#{controladorMantenimientoTramite.controladorMantenimientoTramiteBb.estado}"
                                                 disabled="#{controladorMantenimientoTramite.bloqueoTra}"
                                                 rendered="#{controladorMantenimientoTramite.controladorMantenimientoTramiteBb.tramite.traTipo eq 'L'}"
                                                 value="#{controladorMantenimientoTramite.controladorMantenimientoTramiteBb.tramite.traNumeroJusgado}" />

                                    <p:outputLabel value="Parroquia" style="font-weight: bold"/>
                                    <p:selectOneMenu value="#{controladorMantenimientoTramite.controladorMantenimientoTramiteBb.parroquiaSeleccionada}"
                                                     disabled="#{controladorMantenimientoTramite.bloqueoTra}" filter="true" filterMatchMode="contains">
                                        <f:selectItem itemLabel="Seleccione Uno" itemValue="" />
                                        <f:selectItems value="#{controladorMantenimientoTramite.controladorMantenimientoTramiteBb.listaParroquias}" var="par"
                                                       itemLabel="#{par.parNombre}" itemValue="#{par}" />
                                    </p:selectOneMenu>

                                </p:panelGrid>

                                <p:panelGrid columns="3" 
                                             columnClasses="ui-grid-col-1,ui-grid-col-9,ui-grid-col-2" 
                                             layout="grid" styleClass="ui-panelgrid-blank ui-fluid">
                                    <p:outputLabel value="Observación" for="txtObservacion" style="font-weight: bold"/>
                                    <p:inputText readonly="#{controladorMantenimientoTramite.controladorMantenimientoTramiteBb.estado}"  disabled="#{controladorMantenimientoTramite.bloqueoTra}"
                                                 maxlength="40" id="txtObservacion" value="#{controladorMantenimientoTramite.controladorMantenimientoTramiteBb.tramite.traDescripcion}" />
                                    <p:commandButton class="green-btn" icon="fa fa-save" value="Guardar trámite" update="pnlDatos growl @form" process="pnlDatos"
                                                     disabled="#{controladorMantenimientoTramite.bloqueoTra}" action="#{controladorMantenimientoTramite.guardarTramite()}"
                                                     />
                                </p:panelGrid>
                            </p:panel>

                            <p:separator/>
                            <center><b><p:outputLabel value="Trámite Detalle"/></b></center>
                            <p:separator/>

                            <p:panel id="pnlDatosTraDetalle" style="border: none">


                                <p:panelGrid id="pnlContrato" columns="6" 
                                             columnClasses="ui-grid-col-1,ui-grid-col-1,ui-grid-col-1,ui-grid-col-4,ui-grid-col-1,ui-grid-col-1"
                                             layout="grid" styleClass="ui-panelgrid-blank ui-fluid">

                                    <p:outputLabel value="N°Contratos" style="font-weight: bold" />
                                    <p:inputNumber value="#{controladorMantenimientoTramite.controladorMantenimientoTramiteBb.tramite.traNumeroContrato}"
                                                   decimalPlaces="0" thousandSeparator="" disabled="#{controladorMantenimientoTramite.controladorMantenimientoTramiteBb.listaTramiteDetalle.size() != 0}"/>

                                    <p:outputLabel value="Contrato" style="font-weight: bold" />
                                    <p:selectOneMenu value="#{controladorMantenimientoTramite.controladorMantenimientoTramiteBb.tipoTramiteSeleccionado}"
                                                     filter="true" filterMatchMode="startsWith" required="true"
                                                     disabled="#{controladorMantenimientoTramite.controladorMantenimientoTramiteBb.listaTramiteDetalle.size() != 0}">
                                        <p:ajax event="itemSelect" listener="#{controladorMantenimientoTramite.cargarTipoTramiteCompareciente()}"
                                                process="@this" update="comparecienteLista pnlDatosP"/>
                                        <f:selectItem itemLabel="Seleccione Uno" itemValue="" />
                                        <f:selectItems value="#{controladorMantenimientoTramite.controladorMantenimientoTramiteBb.listaTipoTramite}" var="tip"
                                                       itemLabel="#{tip.ttrDescripcion}" itemValue="#{tip}" />
                                    </p:selectOneMenu>
                                </p:panelGrid>

                                <br/>
                                <p:separator/>
                                <br/>

                                <p:panel id="pnlDatosP" style="border: none">
                                    <div class="ui-g">
                                        <div class="ui-g-12 ui-md-6 ui-lg-4">
                                            <p:commandButton id="crearPersona" immediate="true" icon="fa fa-file-o"  class="green-btn" style="width: 25px"
                                                             oncomplete="PF('dlgNuevaPersona').show()" title="Crear nueva persona"/>
                                            <p:commandButton id="btnFiltrar" class="orange-btn" icon="fa fa-search" style="width: 25px"
                                                             actionListener="#{controladorFiltradoPersona.prepararFiltrado('ToolTraAct', 'formTools:tabsTools:pnlDatosP')}" 
                                                             oncomplete="PF('dlgFiltradoPersona').show();" immediate="true">

                                            </p:commandButton>
                                            <p:outputLabel value="C.I/RUC/PAS    " style="font-weight: bold" for="txtCiRucPas"/>
                                            <p:inputText id="txtCiRucPas" maxlength="13"
                                                         title="Identificación Persona" style="color: #b30000;font-family: Arial, Helvetica, sans-serif;font-size: 15px;"
                                                         value="#{controladorMantenimientoTramite.identificacionTramiteTools}">
                                                <p:ajax event="change" process="@this txtCiRucPas"
                                                        listener="#{controladorMantenimientoTramite.buscarPersona()}"
                                                        update="pnlDatosP growl :PersonaEditForm"/>
                                            </p:inputText>
                                        </div>
                                        <div class="ui-g-12 ui-md-6 ui-lg-2">
                                            <p:outputLabel value="#{controladorMantenimientoTramite.controladorMantenimientoTramiteBb.tramiteDetalle.perId.perApellidoPaterno}
                                                           #{controladorMantenimientoTramite.controladorMantenimientoTramiteBb.tramiteDetalle.perId.perApellidoMaterno} 
                                                           #{controladorMantenimientoTramite.controladorMantenimientoTramiteBb.tramiteDetalle.perId.perNombre}" />
                                        </div>
                                        <div class="ui-g-12 ui-md-6 ui-lg-2">
                                            <p:outputLabel value="Contrato: " style="font-weight: bold"/>
                                            <p:outputLabel value="#{controladorMantenimientoTramite.controladorMantenimientoTramiteBb.tipoTramiteSeleccionado.ttrDescripcion}" style="color: #b30000;font-weight: bold"/>
                                        </div>
                                        <div class="ui-g-12 ui-md-6 ui-lg-4">
                                            <p:outputLabel value="Compareciente:      " style="font-weight: bold"/>
                                            <p:selectOneMenu id="comparecienteLista" value="#{controladorMantenimientoTramite.controladorMantenimientoTramiteBb.tipoTramiteComparecienteSeleccionado}"
                                                             filter="true" filterMatchMode="contains" required="true">
                                                <f:selectItem itemLabel="Seleccione Uno" itemValue="" />
                                                <f:selectItems value="#{controladorMantenimientoTramite.controladorMantenimientoTramiteBb.listTipoTramiteCompareciente}" var="compareciente"
                                                               itemLabel="#{compareciente.tpcId.tpcDescripcion}" itemValue="#{compareciente}" />
                                            </p:selectOneMenu>
                                            <p:outputLabel value="             " />
                                            <p:commandButton class="blue-btn" icon="fa fa-plus" disabled="#{!controladorMantenimientoTramite.blockTabPro}"
                                                             action="#{controladorMantenimientoTramite.agregarTramiteDetalle()}"
                                                             update="pnlTablaTraDetalle pnlContrato pnlDatosP growl btnTerminarTra"
                                                             process="@this pnlDatos pnlContrato txtCiRucPas comparecienteLista"/>
                                        </div>
                                    </div>
                                </p:panel>

                                <br/>
                                <p:separator/>
                                <br/>
                                <p:commandButton class="blue-btn" icon="fa fa-refresh" value="Refrescar" action="#{controladorMantenimientoTramite.limpiar()}" process="@this"
                                                 rendered="#{controladorMantenimientoTramite.blockTabPro}"/>
                                <p:commandButton id="btnTerminarTra" class="green-btn" icon="fa fa-save" value="Terminar" update="@form growl"
                                                 action="#{controladorMantenimientoTramite.guardarTramiteDetalle()}" process="@this"
                                                 disabled="#{controladorMantenimientoTramite.controladorMantenimientoTramiteBb.listaTramiteDetalle.size() == 0}"
                                                 rendered="#{controladorMantenimientoTramite.blockTabPro}"/>

                                <p:panel id="pnlTablaTraDetalle" style="border: none">
                                    <p:dataTable id="tblTraDetalle" value="#{controladorMantenimientoTramite.controladorMantenimientoTramiteBb.listaTramiteDetalle}"
                                                 var="traDetalle" style="text-align-last: center" rowIndexVar="num"
                                                 rendered="#{controladorMantenimientoTramite.controladorMantenimientoTramiteBb.listaTramiteDetalle.size() != 0 }">

                                        <p:column headerText="N° Repertorio" >
                                            <h:outputText value="#{traDetalle.tdtNumeroRepertorio}" />
                                        </p:column>

                                        <p:column headerText="Tipo Trámite">
                                            <h:outputText value="#{traDetalle.ttcId.ttrId.ttrDescripcion}" />
                                        </p:column>

                                        <p:column headerText="Tipo Compareciente">
                                            <h:outputText value="#{traDetalle.ttcId.tpcId.tpcDescripcion}" />
                                        </p:column>

                                        <p:column headerText="Identificación">
                                            <h:outputText value="#{traDetalle.tdtPerIdentificacion}" />
                                        </p:column>

                                        <p:column headerText="Apellido Paterno">
                                            <h:outputText value="#{traDetalle.tdtPerApellidoPaterno}" />
                                        </p:column>

                                        <p:column headerText="Apellido Materno">
                                            <h:outputText value="#{traDetalle.tdtPerApellidoMaterno}" />
                                        </p:column>

                                        <p:column headerText="Nombre">
                                            <h:outputText value="#{traDetalle.tdtPerNombre}" />
                                        </p:column>

                                        <p:column style="width: 25px">
                                            <p:commandButton class="red-btn" icon="fa fa-close" action="#{controladorMantenimientoTramite.eliminarTramiteDetalle(num)}" 
                                                             update="@form" process="@this tblTraDetalle" disabled="#{!controladorMantenimientoTramite.blockTabPro}">
                                                <f:setPropertyActionListener value="#{traDetalle}" 
                                                                             target="#{controladorMantenimientoTramite.controladorMantenimientoTramiteBb.tramiteDetalleSeleccionado}"/>
                                                <f:setPropertyActionListener value="#{controladorMantenimientoTramite.controladorMantenimientoTramiteBb.listaRepertorios.get(num)}" 
                                                                             target="#{controladorMantenimientoTramite.controladorMantenimientoTramiteBb.repertorioSeleccionado}"/>
                                                <f:setPropertyActionListener value="#{controladorMantenimientoTramite.controladorMantenimientoTramiteBb.listTramiteValor.get(num)}" 
                                                                             target="#{controladorMantenimientoTramite.controladorMantenimientoTramiteBb.tramiteValorSeleccionado}"/>
                                            </p:commandButton>
                                        </p:column>
                                    </p:dataTable>
                                </p:panel>
                            </p:panel>

                        </p:tab>
                        <p:tab id="tabPropiedad" title="Propiedad" disabled="#{controladorMantenimientoTramite.blockTabPro}">
                            <p:panel id="pnlPropiedadTools" style="border: none">
                                <p:panelGrid id="pnlPropiedades" columns="7" layout="grid" 
                                             columnClasses="ui-grid-col-1,ui-grid-col-3,ui-grid-col-1,ui-grid-col-3,ui-grid-col-1,ui-grid-col-1,ui-grid-col-2" 
                                             styleClass="ui-panelgrid-blank ui-fluid">
                                    <p:outputLabel for="@next" value="Predio" />
                                    <p:inputText id="txtPredio" value="#{controladorMantenimientoTramite.predio}"/>
                                    <p:outputLabel for="@next" value="Catastro" />
                                    <p:inputText id="txtActaP" value="#{controladorMantenimientoTramite.catastro}"/>
                                    <p:commandButton class="blue-btn" icon="fa fa-search" update="growl tblProps btnGuardarProp"
                                                     process="txtActaP txtPredio @this" disabled="#{!controladorMantenimientoTramite.blockTabPropietario}"
                                                     action="#{controladorMantenimientoTramite.buscarPropiedad()}"/>
                                    <p:commandButton class="orange-btn" icon="fa fa-plus"  update="tblProps :formTools :formNuevasMatriculas"
                                                     process="@this " onsuccess="PF('dlgNuevaPropiedad').show();" 
                                                     disabled="#{!controladorMantenimientoTramite.blockTabPropietario}"
                                                     action="#{controladorMantenimientoTramite.abrirNuevaPropiedad()}"/>
                                    <p:commandButton id="btnGuardarProp" class="green-btn" icon="fa fa-save"
                                                     update="@form formTools:tabsTools:pnlPropiedadTools" value="Terminar"
                                                     process="formTools:tabsTools:pnlPropiedadTools" 
                                                     disabled="#{controladorMantenimientoTramite.listaPropiedades.size() == 0}"
                                                     rendered="#{controladorMantenimientoTramite.blockTabPropietario}"
                                                     action="#{controladorMantenimientoTramite.habilitarPropietario()}"/>
                                </p:panelGrid>

                                <p:dataTable id="tblProps" var="prop" value="#{controladorMantenimientoTramite.listaPropiedades}"
                                             selection="#{controladorMantenimientoTramite.listaPropiedadesSeleccionadas}" rowKey="#{prop.prdMatricula}"
                                             scrollable="true" scrollHeight="400">
                                    <p:ajax event="rowSelectCheckbox" />
                                    <p:ajax event="rowUnselectCheckbox" />
                                    <p:column headerText="N° Matricula">
                                        <h:outputText value="#{prop.prdMatricula}" />
                                    </p:column>

                                    <p:column headerText="Catastro">
                                        <h:outputText value="#{prop.prdCatastro}" />
                                    </p:column>

                                    <p:column headerText="Predio">
                                        <h:outputText value="#{prop.prdPredio}" />
                                    </p:column>

                                    <p:column headerText="Tipo Propiedad">
                                        <h:outputText value="#{prop.tpdId.tpdNombre}" />
                                    </p:column>

                                    <p:column selectionMode="multiple" style="width:16px;text-align:center" rendered="#{controladorMantenimientoTramite.blockTabPropietario}"/>
                                </p:dataTable>
                            </p:panel>
                        </p:tab>
                        <p:tab id="tabPropietario" title="Propietario" disabled="#{controladorMantenimientoTramite.blockTabPropietario}">
                            <p:panel id="pnlPropietarios" style="border: none">
                                <div class="ui-g">
                                    <div class="ui-g-12 ui-md-6 ui-lg-6">
                                        <p:commandButton id="btnGuardarPropP" icon="fa fa-save" value="Terminar"
                                                         action="#{controladorMantenimientoTramite.habilitarActa()}"
                                                         update="formTools:tabsTools:pnlPropietarios @form"
                                                         process="formTools:tabsTools:pnlPropietarios"
                                                         class="green-btn" title="Guardar Propiedades con propietarios"
                                                         rendered="#{controladorMantenimientoTramite.blockTabActa}"/>

                                        <br/>
                                        <br/>
                                        <br/>

                                        <p:dataTable id="tblPropiedades" var="propiedad" value="#{controladorMantenimientoTramite.listaPropiedadesSeleccionadas}"
                                                     scrollable="true" scrollHeight="450"
                                                     selectionMode="single" selection="#{controladorMantenimientoTramite.propiedadSeleccionada}" rowKey="#{propiedad.prdMatricula}">
                                            <p:ajax event="rowSelect" listener="#{controladorMantenimientoTramite.listarPropietariosPorPropiedad()}" update="formTools:tabsTools:pnlPropietarios"/>
                                            <p:column style="width:15px">
                                                <p:rowToggler />
                                            </p:column>
                                            <p:column headerText="Matricula">
                                                <h:outputText value="#{propiedad.prdMatricula}" />
                                            </p:column>

                                            <p:column headerText="Catastro">
                                                <h:outputText value="#{propiedad.prdCatastro}" />
                                            </p:column>

                                            <p:column headerText="Predio">
                                                <h:outputText value="#{propiedad.prdPredio}" />
                                            </p:column>

                                            <p:column headerText="Tipo propiedad">
                                                <h:outputText value="#{propiedad.tpdId.tpdNombre}" />
                                            </p:column>
                                            <p:rowExpansion>

                                                <p:dataTable var="propietario" value="#{controladorMantenimientoTramite.listaPropietariosP}"
                                                             sortBy="#{propietario.perId.perApellidoPaterno}" 
                                                             emptyMessage="No tiene propietarios la propiedad seleccionada">
                                                    <p:column headerText="Propietarios" groupRow="true">
                                                        <h:outputText value="#{propietario.perId.perApellidoPaterno} #{propietario.perId.perApellidoMaterno} #{propietario.perId.perNombre}" />
                                                    </p:column>
                                                </p:dataTable>
                                            </p:rowExpansion>
                                        </p:dataTable>
                                    </div>
                                    <div class="ui-g-12 ui-md-6 ui-lg-6">
                                        <p:panel id="pnlListPropietarios" style="border: none"
                                                 rendered="#{controladorMantenimientoTramite.renderPnlProp}">
                                            <h:panelGrid columns="5" cellpadding="5">

                                                <p:commandButton id="btnBuscarPersona" immediate="true" icon="fa fa-search"  
                                                                 class="orange-btn" title="Buscar Persona" 
                                                                 action="#{controladorFiltradoPersona.prepararFiltrado('PropTools', 'formTools:tabsTools:pnlListPropietarios')}"
                                                                 oncomplete ="PF('dlgFiltradoPersona').show()"
                                                                 disabled="#{!controladorMantenimientoTramite.blockTabActa}"/>
                                                <p:commandButton id="btnCrearPersona" immediate="true" icon="fa fa-user-plus"  class="green-btn" 
                                                                 oncomplete="PF('dlgNuevaPersona').show()" title="Crear nueva persona"
                                                                 disabled="#{!controladorMantenimientoTramite.blockTabActa}"/>

                                                <p:outputLabel value="CI/RUC/Pas." for="@next"/>
                                                <p:inputText id="txtCiRucPasT" size="20"
                                                             maxlength="13"
                                                             title="Identificación Persona" 
                                                             style="color: #b30000;font-family: Arial, Helvetica, sans-serif;font-size: 15px;"
                                                             value="#{controladorMantenimientoTramite.identificacion}" 
                                                             disabled="#{!controladorMantenimientoTramite.blockTabActa}"
                                                             onkeypress="if (event.keyCode == 13) {
                                                                         return false;
                                                                     }">
                                                    <p:ajax event="change" listener="#{controladorMantenimientoTramite.buscarPersonaP()}" 
                                                            update="formTools:tabsTools:pnlListPropietarios :PersonaEditForm"/>
                                                </p:inputText>
                                                <p:commandButton id="btnGuardarPropietarios" icon="fa fa-save" value="Guardar Propietarios"
                                                                 class="green-btn" title="Guardar Propietarios" action="#{controladorMantenimientoTramite.guardarPropietarios()}"
                                                                 update="formTools:tabsTools:pnlListPropietarios growl" process="formTools:tabsTools:pnlListPropietarios"
                                                                 disabled="#{controladorMantenimientoTramite.listaPersonas.size() == 0}"
                                                                 rendered="#{controladorMantenimientoTramite.blockTabActa}"/>
                                            </h:panelGrid>
                                            <h:panelGrid columns="3" cellpadding="5" rendered="#{controladorMantenimientoTramite.nombrePersonaProp != ''}">
                                                <h:outputLabel value="Persona" for="txtPersonas" style="font-weight: bold;color: #b30000"></h:outputLabel>
                                                <p:outputLabel id="txtPersonas" value="#{controladorMantenimientoTramite.nombrePersonaProp}"/>

                                                <p:commandButton id="btn_add" value="Añadir Propietario" icon="fa fa-plus"
                                                                 update="propietariosT growl formTools:tabsTools:pnlListPropietarios" 
                                                                 action="#{controladorMantenimientoTramite.añadirProp()}" 
                                                                 process="formTools:tabsTools:pnlPropietarios"
                                                                 disabled="#{!controladorMantenimientoTramite.blockTabActa}">
                                                    <p:collector value="#{controladorMantenimientoTramite.personaPropietaria}" 
                                                                 addTo="#{controladorMantenimientoTramite.listaPersonas}" unique="true"/>
                                                </p:commandButton>

                                                <h:outputLabel value="Estado" for="txtEstado"></h:outputLabel>
                                                <p:selectOneRadio id="txtEstado" value="#{controladorMantenimientoTramite.estadoPersonaProp}" required="true">
                                                    <f:selectItem itemLabel="Activo" itemValue="A" />
                                                    <f:selectItem itemLabel="Inactivo" itemValue="I" />
                                                </p:selectOneRadio>
                                            </h:panelGrid>

                                            <p:outputPanel id="propietariosT" style="height: 50px">
                                                <p:dataTable value="#{controladorMantenimientoTramite.listaPersonas}" var="persona"
                                                             scrollable="true" scrollHeight="349" sortBy="#{persona.perIdentificacion}">

                                                    <p:column headerText="Propietario">
                                                        <h:outputText value="#{persona.perApellidoPaterno} #{persona.perApellidoMaterno} #{persona.perNombre}" />
                                                    </p:column>

                                                    <p:column>
                                                        <p:commandLink class="red-btn" value="Remove"
                                                                       update="formTools:tabsTools:propietariosT formTools:tabsTools:pnlListPropietarios"
                                                                       process="formTools:tabsTools:propietariosT" 
                                                                       disabled="#{!controladorMantenimientoTramite.blockTabActa}">
                                                            <p:collector value="#{persona}" removeFrom="#{controladorMantenimientoTramite.listaPersonas}" unique="true"/>
                                                        </p:commandLink>
                                                    </p:column>
                                                </p:dataTable>
                                            </p:outputPanel>
                                        </p:panel>
                                    </div>
                                </div>
                            </p:panel>
                        </p:tab>
                        <p:tab id="tabActaTools" title="Acta" disabled="#{controladorMantenimientoTramite.blockTabActa}">

                            <p:panel style="border: none">
                                <p:panelGrid columns="2" columnClasses="ui-grid-col-1,ui-grid-col-2" 
                                             layout="grid" styleClass="ui-panelgrid-blank ui-fluid">
                                    <p:outputLabel value="N° Trámite"/>
                                    <p:inputText value="#{controladorMantenimientoTramite.controladorMantenimientoTramiteBb.numTramite}" required="true" requiredMessage="N° Trámite, Es Campo Requerido">
                                        <p:ajax event="change" listener="#{controladorMantenimientoTramite.buscarTramiteValor()}" update="@form growl"/>
                                    </p:inputText>
                                </p:panelGrid>

                                <br/>
                                <p:separator/>

                                <p:panelGrid id="datosRep" layout="grid"
                                             columnClasses="ui-grid-col-2,ui-grid-col-4,ui-grid-col-2,ui-grid-col-4,ui-grid-col-2,ui-grid-col-4,ui-grid-col-2,ui-grid-col-4"
                                             columns="8" styleClass="ui-panelgrid-blank ui-fluid">
                                    <p:outputLabel for="txtNumTramite" value="# Trámite"/>
                                    <p:inputText id="txtNumTramite" value="#{controladorMantenimientoTramite.repertorio.traNumero.traNumero}" readonly="true"
                                                 style="color: #1a237e"/>
                                    <p:outputLabel for="txtRepertorio" value="Repertorio"/>
                                    <p:inputText id="txtRepertorio" value="#{controladorMantenimientoTramite.repertorio.repNumero}" readonly="true"
                                                 style="color: #1a237e"/>
                                    <p:outputLabel for="txtFecha" value="Fecha"/>
                                    <p:inputText id="txtFecha" value="#{controladorMantenimientoTramite.repertorio.repFHR}" readonly="true">
                                        <f:convertDateTime pattern="dd-MM-yyyy"/>
                                    </p:inputText>

                                </p:panelGrid>


                                <br/>

                                <p:layout id="lMantenimiento" style="min-width:400px;min-height:420px;" >

                                    <p:layoutUnit id="luActa" position="west" resizable="true" size="300" header="TRÁMITES" 
                                                  minSize="100" maxSize="350" collapsible="true" effect="drop"
                                                  style="border: none">
                                        <p:dataTable var="traValor" value="#{controladorMantenimientoTramite.listaTramiteValor}"
                                                     selectionMode="single" selection="#{controladorMantenimientoTramite.tramiteValorSeleccionado}"
                                                     rowKey="#{traValor.trvId}" sortBy="#{traValor.traNumero.traNumero}">

                                            <p:ajax event="rowSelect" listener="#{controladorMantenimientoTramite.buscarRepertorio()}"
                                                    update=":formTools:tabsTools:datosRep"/>

                                            <p:column headerText="Tipo Tramite" groupRow="true">
                                                <h:outputText value="#{traValor.ttrId.ttrDescripcion}" />
                                            </p:column>

                                            <p:column headerText="N° Trámite" groupRow="true">
                                                <h:outputText value="#{traValor.traNumero.traNumero}" />
                                            </p:column>
                                        </p:dataTable>
                                    </p:layoutUnit>

                                    <p:layoutUnit id="luActSelecc" position="center" resizable="true" size="680" minSize="680" maxSize="700" 
                                                  style="border: none">
                                        <p:commandButton id="btnConcluir" class="green-btn" icon="fa fa-save" value="Terminar" process=":formTools:tabsTools:lMantenimiento"
                                                         action="#{controladorMantenimientoTramite.guardarActa()}" update="@form growl :frmConfRepertorio"
                                                         disabled="#{controladorMantenimientoTramite.listaPropiedadesSeleccionadas.size() == 0 and !controladorMantenimientoTramite.boolVerNuevaProp}"
                                                         onsuccess="PF('dlgConfRepertorio').show();"/>

                                        <br/>
                                        <br/>
                                        <br/>                                       

                                        <p:outputLabel for="txtActa" value="Acta" style="font-weight: bold"/>
                                        <p:textEditor id="txtActa" toolbarVisible="false"
                                                      widgetVar="acta" value="#{controladorMantenimientoTramite.acta.actActaPdf}"
                                                      height="185" style="margin-bottom:10px; text-align: justify;font-family: monospace"
                                                      readonly="#{controladorMantenimientoTramite.estaActa}"/>

                                        <p:outputLabel for="txtAntecedentes" value="Objeto del contrato" style="font-weight: bold"/>
                                        <p:textEditor id="txtAntecedentes" toolbarVisible="false" required="true"
                                                      widgetVar="actaAntecedentes" value="#{controladorMantenimientoTramite.acta.actDescripcion3}" 
                                                      height="185" style="margin-bottom:10px; text-align: justify;font-family: monospace"
                                                      readonly="#{controladorMantenimientoTramite.estaActa}"/>

                                        <p:outputLabel for="txtFormAdq" value="Formas de Adquisición" style="font-weight: bold"/>
                                        <p:textEditor id="txtFormAdq" toolbarVisible="false" required="true"
                                                      widgetVar="actaFormAdquisicion" value="#{controladorMantenimientoTramite.acta.actDescripcion9}"
                                                      height="185" style="margin-bottom:10px; text-align: justify;font-family: monospace"
                                                      readonly="#{controladorMantenimientoTramite.estaActa}"/>

                                    </p:layoutUnit>
                                </p:layout>
                            </p:panel>
                        </p:tab>
                    </p:tabView>
                </h:form>

                <p:dialog widgetVar="dlgNuevaPropiedad" modal="true" position="center center">

                    <h:form id="formNuevasMatriculas">
                        <p:commandButton class="green-btn" icon="fa fa-save" value="Guardar" update=":formTools"
                                         action="#{controladorMantenimientoTramite.guardarPropiedad()}" 
                                         oncomplete="PF('dlgNuevaPropiedad').hide();"/>
                        <div class="ui-g">
                            <div class="ui-g-6">
                                <p:panel header="Datos De Identificación" >
                                    <h:panelGrid columns="2" cellspacing="10">
                                        <p:outputLabel for="txtMatricula" value="Matricula" style="text-align: right"/>

                                        <h:panelGrid columns="2" cellspacing="0" border="0" >
                                            <p:inputText id="txtMatricula" size="55" readonly="true" style="width: 250px" value="#{controladorMantenimientoTramite.propiedadNueva.prdMatricula}"/>

                                        </h:panelGrid>

                                        <p:outputLabel for="txtNumero" value="Número" style="text-align: right"/>
                                        <p:inputText id="txtNumero" style="width: 250px" value="#{controladorMantenimientoTramite.propiedadNueva.prdUnidadVivienda}"/>
                                        <p:outputLabel for="txtCatastro" value="Catastro" style="text-align: right"/>
                                        <p:inputText id="txtCatastro" style="width: 250px" value="#{controladorMantenimientoTramite.propiedadNueva.prdCatastro}" size="55"/>
                                        <p:outputLabel for="txtPredio" value="Predio" style="text-align: right"/>
                                        <p:inputText id="txtPredio" style="width: 250px" value="#{controladorMantenimientoTramite.propiedadNueva.prdPredio}" size="55"/>
                                        <p:outputLabel for="txtParroquiaHistorica" value="Parroquia Historica" style="text-align: right"/>
                                        <p:selectOneMenu id="txtParroquiaHistorica" required="true" style="width: 250px" value="#{controladorMantenimientoTramite.propiedadNueva.prdTdtParIdH}"
                                                         filter="true" disabled="true">
                                            <p:ajax event="change" update="txtParroquiaActual txtDescripcion" listener="#{controladorMantenimientoTramite.seleccionarParroquiaHistorica()}"/>
                                            <f:selectItem itemLabel="Seleccione uno..."/>
                                            <f:selectItems value="#{controladorMantenimientoTramite.listaParroquias}" var="parroquia" itemLabel="#{parroquia.parNombre}" itemValue="#{parroquia.parId}"/>
                                        </p:selectOneMenu>

                                        <p:outputLabel for="txtParroquiaActual" value="Parroquia Actual" style="text-align: right"/>
                                        <p:selectOneMenu id="txtParroquiaActual" required="true" style="width: 250px" 
                                                         value="#{controladorMantenimientoTramite.propiedadNueva.prdTdtParId}">
                                            <p:ajax event="change" listener="#{controladorMantenimientoTramite.seleccionarParroquiaActual()}"/>
                                            <p:ajax event="change" update="txtDescripcion" listener="#{controladorMantenimientoTramite.llenarDescripcion2()}"/>
                                            <f:selectItem itemLabel="Seleccione uno..."/>
                                            <f:selectItems value="#{controladorMantenimientoTramite.listaParroquias}" var="parroquia"
                                                           itemLabel="#{parroquia.parNombre}" itemValue="#{parroquia.parId}"/>                                        
                                        </p:selectOneMenu>
                                        <p:outputLabel for="txtEspacial" value="Espacial" style="text-align: right" />
                                        <h:panelGrid columns="2" cellspacing="5">
                                            <p:commandButton class="orange-btn" icon="fa fa-search" onsuccess="PF('dlgMap').show()"
                                                             action="#{controladorMantenimientoTramite.verificarPosicion()}"
                                                             update=":formMapa:gmap" process="@this txtNumero txtCatastro txtPredio txtParroquiaHistorica txtParroquiaActual"/>
                                            <p:inputText id="txtEspacial" style="width: 250px" size="45" value="#{controladorMantenimientoTramite.propiedadNueva.prdEspacial}"
                                                         readonly="true"/>
                                        </h:panelGrid>

                                        <p:outputLabel for="txtTipo"  value="Tipo" style="text-align: right" />
                                        <p:selectOneMenu id="txtTipo" required="true" style="width: 250px" 
                                                         value="#{controladorMantenimientoTramite.propiedadNueva.tpdId}" >
                                            <p:ajax event="change" update="txtDescripcion" listener="#{controladorMantenimientoTramite.llenarDescripcion2()}"/>                                                    
                                            <f:selectItem itemLabel="Seleccione uno..."/>
                                            <f:selectItems value="#{controladorMantenimientoTramite.listaTipoPropiedad}" var="tipoPropiedad" 
                                                           itemLabel="#{tipoPropiedad.tpdNombre}" itemValue="#{tipoPropiedad}" />
                                        </p:selectOneMenu>

                                        <p:outputLabel for="txtClase" value="Clase" style="text-align: right"/>
                                        <p:selectOneMenu id="txtClase" required="true" style="width: 250px" 
                                                         value="#{controladorMantenimientoTramite.propiedadNueva.prdClasePropiedad}"  
                                                         >
                                            <f:selectItem itemLabel="Seleccione uno..."/>
                                            <f:selectItem itemLabel="HORIZONTAL" itemValue="H" />
                                            <f:selectItem itemLabel="ORDINARIA" itemValue="O"/>
                                            <p:ajax event="change" process="@this"  
                                                    listener="#{controladorMantenimientoTramite.seleccionarClase()}"/>
                                        </p:selectOneMenu>                                                


                                        <p:outputLabel for="btnCrearLindero" value="Lindero" style="text-align: right"/>

                                        <p:commandButton id="btnCrearLindero" value="Agregar Linderos" immediate="true"
                                                         process="@this"
                                                         icon="fa fa-plus" class="cyan-btn"
                                                         actionListener="#{controladorMantenimientoTramite.preCrearLindero()}"  
                                                         oncomplete="PF('dlgLinderos').show()"
                                                         update=":frmLinderos"/>

                                        <h:outputText />

                                        <p:dataTable id="dtbLinderos" value="#{controladorMantenimientoTramite.listaLinderos}" 
                                                     var="item" rowKey="#{item.ldrId}" 
                                                     style="width: 400px"
                                                     editable="true" editMode="cell">
                                            <p:column headerText="Nombre">
                                                <p:cellEditor>
                                                    <f:facet name="output"> <h:outputText value="#{item.ldrNombre}"/></f:facet> 
                                                    <f:facet name="input"><p:inputText value="#{item.ldrNombre}" style="width:96%" /></f:facet>
                                                </p:cellEditor>
                                            </p:column>
                                            <p:column style="width: 15%">
                                                <p:commandButton class="red-btn" icon="fa fa-remove" 
                                                                 immediate="true" 
                                                                 update="growl
                                                                 formNuevasMatriculas:dtbLinderos"
                                                                 action="#{controladorMantenimientoTramite.borrarLindero()}">
                                                    <f:setPropertyActionListener target="#{controladorMantenimientoTramite.linderoSeleccionado}"
                                                                                 value="#{item}"/>
                                                </p:commandButton>
                                            </p:column>
                                        </p:dataTable>
                                    </h:panelGrid>




                                </p:panel>
                            </div>

                            <div class="ui-g-6">
                                <p:panel header="Datos Descriptivos" >
                                    <h:panelGrid columns="2" cellspacing="10">
                                        <p:outputLabel for="txtSuperficie"  value="Superficie"/>
                                        <p:inputNumber id="txtSuperficie" style="width: 250px" value="#{controladorMantenimientoTramite.propiedadNueva.prdSuperficie}" size="60" maxlength="6" required="true" requiredMessage="Superficie Requerida">
                                            <p:ajax event="change" listener="#{controladorMantenimientoTramite.llenarDescripcion1()}" update="txtSuperficieLetras growl"/>
                                        </p:inputNumber>
                                        <h:outputText/>
                                        <p:selectOneMenu id="txtSuperficieTipo"  style="width: 250px" 
                                                         value="#{controladorMantenimientoTramite.propiedadNueva.umdId}" 
                                                         filter="true" required="true" requiredMessage="Requerido Unidad de Medida">
                                            <p:ajax event="change" listener="#{controladorMantenimientoTramite.llenarDescripcion1()}"
                                                    update="txtSuperficieLetras growl"/>
                                            <f:selectItem itemLabel="Seleccione uno..."/>
                                            <f:selectItems value="#{controladorMantenimientoTramite.listaUnidMedida}" var="unidMedida" itemLabel="#{unidMedida.umdNombre}" itemValue="#{unidMedida}"/>
                                        </p:selectOneMenu>
                                        <h:outputText/>
                                        <p:inputTextarea id="txtSuperficieLetras" style="width: 250px" value="#{controladorMantenimientoTramite.propiedadNueva.prdDescripcion1}" rows="2"  readonly="true"/>
                                        <p:outputLabel for="txtDescripcion" value="Descripción"/>
                                        <p:inputTextarea id="txtDescripcion" style="width: 250px" rows="7" value="#{controladorMantenimientoTramite.propiedadNueva.prdDescripcion2}"  readonly="true"/>

                                        <p:outputLabel for="Estado" value="Estado"/>
                                        <p:selectOneRadio id="Estado" required="true" requiredMessage="El campo estado, es requerido"
                                                          value="#{controladorMantenimientoTramite.propiedadNueva.prdEstadoPropiedad}">
                                            <f:selectItem itemLabel="Activo" itemValue="AC"  />

                                        </p:selectOneRadio>
                                    </h:panelGrid>
                                </p:panel>
                            </div>
                        </div>
                    </h:form>

                </p:dialog>

                <p:dialog id="dlgLinderos" modal="true" header="Linderos" widgetVar="dlgLinderos">
                    <h:form id="frmLinderos">

                        <h:panelGrid columns="3">
                            <p:outputLabel for="@next" value="Nombre"/>
                            <p:inputTextarea cols="30" value="#{controladorMantenimientoTramite.linderoSeleccionado.ldrNombre}"
                                             required="true" requiredMessage="El campo Nombre, es requerido"
                                             />

                            <p:commandButton  class="green-btn" icon="fa fa-plus" 
                                              action="#{controladorMantenimientoTramite.crearLindero()}" 
                                              update="growl @form 
                                              :formNuevasMatriculas:dtbLinderos" 
                                              />
                        </h:panelGrid>

                        <h:panelGroup>

                            <p:commandButton class="blue-btn" icon="fa fa-close" 
                                             value="Cerrar" immediate="true"
                                             onclick="PF('dlgLinderos').hide()"/>

                        </h:panelGroup>
                    </h:form>
                </p:dialog>

                <p:dialog widgetVar="dlgMap" modal="true" resizable="false" closable="false" position="center center"
                          responsive="true" width="1000" height="600">
                    <h:form id="formMapa">
                        <script type="text/javascript" src="https://maps.google.com/maps/api/js?key=AIzaSyC7R9us6s7z77X-uy5zaAc6DzUM6u0-7c4"></script>
                        <p:gmap id="gmap" widgetVar="map" center="#{controladorMantenimientoTramite.centerGeoMap}" 
                                zoom="#{controladorMantenimientoTramite.zoom}" 
                                type="ROADMAP" style="width:100%;height:500px" 
                                model="#{controladorMantenimientoTramite.geoModel}" >
                            <p:ajax event="stateChange" listener="#{controladorMantenimientoTramite.onZoomAction}"/>
                            <p:ajax event="pointSelect" listener="#{controladorMantenimientoTramite.onPointSelect}" update="growl :formNuevasMatriculas:txtEspacial gmap btnGuardarProp" />
                        </p:gmap>
                        <br/>
                        <p:panelGrid columns="5" layout="grid" columnClasses="ui-grid-col-1,ui-grid-col-5,ui-grid-col-2,ui-grid-col-2,ui-grid-col-2" styleClass="ui-panelgrid-blank ui-fluid" >
                            <p:outputLabel for="txtDireccionP" value="Dirección"/>
                            <p:inputText id="txtDireccionP" value="#{controladorMantenimientoTramite.direccion}" 
                                         placeholder="Barrio Calle principal N°casa"
                                         required="true" requiredMessage="Dirección, Campo Requerido"/>
                            <p:commandButton id="btnBuscarProp" class="orange-btn" icon="fa fa-map-marker" value="Buscar"
                                             action="#{controladorMantenimientoTramite.localizarPorDireccion()}"
                                             update="gmap txtDireccionP growl btnGuardarProp"/>
                            <p:commandButton id="btnGuardarProp" class="green-btn" icon="fa fa-save" value="Guardar" process="gmap @this"
                                             disabled="#{controladorMantenimientoTramite.lat == null and controladorMantenimientoTramite.lng == null}"
                                             action="#{controladorMantenimientoTramite.guadarLocalizacion()}"
                                             onclick="PF('dlgMap').hide()" update=":formNuevasMatriculas"/>
                            <p:commandButton class="red-btn" icon="fa fa-close" value="Salir" process="@this"
                                             onclick="PF('dlgMap').hide()"/>
                        </p:panelGrid>
                    </h:form>
                </p:dialog>

                <p:dialog widgetVar="dlgConfRepertorio" resizable="false" closable="false" position="center center" modal="true">
                    <h:form id="frmConfRepertorio">
                        <p:panelGrid columns="2" layout="grid" columnClasses="ui-grid-col-6,ui-grid-col-6" styleClass="ui-panelgrid-blank ui-fluid" >
                            <p:outputLabel for="@next" value="N° Repertorio:" style="font-weight: bold"/>
                            <p:inputText value="#{controladorMantenimientoTramite.repertorio.repNumero}" readonly="true"/>
                            <p:outputLabel for="@next" value="Fecha Repertorio:" style="font-weight: bold"/>
                            <p:inputText value="#{controladorMantenimientoTramite.repertorio.repFHR}" readonly="true">
                                <f:convertDateTime pattern="dd-MM-yyyy"/>
                            </p:inputText>
                            <p:outputLabel for="@next" value="Libro" style="font-weight: bold"/>
                            <p:inputText value="#{controladorMantenimientoTramite.repertorio.repTtrDescripcion}" readonly="true"/>
                        </p:panelGrid>
                        <p:commandButton class="red-btn" value="Cerrar" icon="fa fa-close" action="#{controladorMantenimientoTramite.recargar()}" immediate="true"/>
                    </h:form>
                </p:dialog>

                <ui:include src="/paginas/PROCESOS/persona/persona.xhtml"/>
                <ui:include src="/paginas/FiltradoPersona.xhtml"/>
            </ui:define>

        </ui:composition>

    </body>
</html>
